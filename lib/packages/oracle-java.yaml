package:  oracle-java
versions: [7.51, 8.121, 8.131, 8.144, 8.151]

variables:
  - version: "=8.131"
    url: "http://download.oracle.com/otn-pub/java/jdk/8u131-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk-8u131-linux-x64.tar.gz"

    # Oracle has removed this URL
  - version: "=8.144"
    url: "http://download.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/jdk-8u144-linux-x64.tar.gz"

  - version: "=8.151"
    url: "http://download.oracle.com/otn-pub/java/jdk/8u151-b12/e758a0de34e24606bca991d704f6dcbf/jdk-8u151-linux-x64.tar.gz"

    # URL doesn't work
    #- version: "=9.181"
    #url: "http://download.java.net/java/GA/jdk9/9/binaries/jdk-9+181_linux-x64_bin.tar.gz"

dependencies:
  - version: ">=7"
    install: []
    build: []
    aliases: [jdk, jre, javac]

download:
  - version: ">=7"
    shell: |
        set +x
        if [ "$url" != "" ]; then
            wget -O download.tar.gz -c --header "Cookie: oraclelicense=accept-securebackup-cookie" "$url"
        else
            echo
            (
                echo "Oracle requires license agreement and hoop-jumping before download."
                echo "Visit http://www.oracle.com using a browser with privacy and safety features disabled"
                echo "(javascript and cookies required). Look for the Java JDK (not the JRE), and download"
                echo "the *.tar.gz version. Move that tarball to $SPOCK_VARDIR/downloads/$PACKAGE_NAME-$PACKAGE_VERSION.tar.gz,"
                echo "and then re-run this command."
            ) |fmt
            exit 1
        fi

install:
  - version: ">=7"
    shell: |
        # Oracle JDK tarballs untar into directories named jdk1.7.0_51 for version 7.51, jdk1.8.0_121 for version 8.121, etc.
        cp -pdR jdk* "$PACKAGE_ROOT/jdk"

        libjvm=$(find "$PACKAGE_ROOT/jdk" -name libjvm.so)
        serverlib="${libjvm%/libjvm.so}"

        spock-export PATH            $PACKAGE_ROOT/jdk/bin
        spock-export LD_RUN_PATH     $serverlib
        spock-export JAVA_LIBDIRS    $serverlib
        spock-export JAVA_VENDOR     oracle
        spock-export JAVA_COMPILER   $PACKAGE_ROOT/jdk/bin/javac
